"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[30],{1030:function(n,e,t){t.r(e),t.d(e,{CanvasContainer:function(){return hn},default:function(){return pn}});var r=t(2723),a=t(4795),i=t(8777),c=t(969),o=t(7563),u=t(3028),s=t(8068),l=t(3649),d=t(1576),f=t(9008),v=t(804),h=(0,s.hg)("canvas/list",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(e,t){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.dispatch,n.next=3,(0,d.U2)("/drawing");case 3:return 200===(i=n.sent).status&&a(v.Nw.patch({items:i.data.items,loaded:!0})),n.abrupt("return",i.data);case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),p=(0,s.hg)("canvas/get",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(e,t){var a,i,c,o,u,s,h,p,x;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=t.dispatch,c=t.getState,u=c(),s=null===(a=u.app.user)||void 0===a?void 0:a.userId,o=u.canvas.items.find((function(n){return n.drawingId===e}))){n.next=12;break}return n.next=7,(0,d.U2)("/drawing/".concat(e));case 7:404===(h=n.sent).status&&i((0,l.cB)("Drawing ".concat(e," not found"))),p=h.data||(0,f.eJ)(),x=p.userId===s,o=x?p:(0,f.sn)(p);case 12:return i(v.Nw.patchActive(o)),n.abrupt("return",o);case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),x=(0,s.hg)("canvas/save",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(e,t){var a,i,c,o,s,f,h;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.history,i=e.thumbnail,c=t.dispatch,o=t.getState,s=o(),f=(0,u.Z)((0,u.Z)({},s.canvas.active),{},{history:a,thumbnail:i}),["draft","copy"].includes(f.drawingId)&&(f.drawingId=void 0),n.next=7,(0,d.WY)("/drawing",f);case 7:return 200===(h=n.sent).status&&(c(v.Nw.onSave(h.data)),c((0,l.h4)("Saved, scroll down to see"))),n.abrupt("return",h.data);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),g=(0,s.hg)("canvas/delete",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(e,t){var a,i,c,o,u;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.dispatch,i=t.getState,n.next=3,(0,d.WY)("/drawing/".concat(e),null,d.n$.DELETE);case 3:if(200===n.sent.status){n.next=6;break}return n.abrupt("return");case 6:c=i().canvas.items,o=c.filter((function(n){return n.drawingId!==e})),u=o.find((function(n){return n.drawingId===e}))||(0,f.eJ)(),a(v.Nw.patch({items:o,active:u}));case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),w=t(1035),m=t(325),Z=t(7574);function j(){var n=(0,o.CG)((function(n){return n.canvas.loading}));return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(m.Z,{className:"".concat(n?"":"invisible"),sx:{position:"absolute",left:"50%",top:"50%"}})})}var C,b,k,y,P=t(7709),I=t(3377),S=t(2207),R=t(7548),N=t(4780),T=t(8930),E=t(8807),D=t(6385),L=t(734),G=t(7024),A=t(1925);function z(n){var e=(0,o.CG)((function(n){return n.app.token})),t=(0,o.CG)((function(n){return n.canvas.items})),i=(0,o.CG)((function(n){return n.canvas.loaded})),s=(0,o.TL)(),l=(0,L.s0)(),d=(0,L.UO)().id,f=((0,o.CG)((function(n){var e;return null===(e=n.canvas.active)||void 0===e?void 0:e.drawingId})),function(n){s(v.Nw.patchActive(n)),l("".concat(G.nB.Draw,"/").concat(null===n||void 0===n?void 0:n.drawingId),{replace:!0})}),p=function(){var n=(0,a.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s(g(e.drawingId));case 2:"fulfilled"===n.sent.meta.requestStatus&&d===e.drawingId&&l(G.nB.Draw,{replace:!0});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return c.useEffect((function(){!i&&e&&s(h())}),[s,i,e]),t.length?(0,Z.jsx)(w.Z,(0,u.Z)((0,u.Z)({maxWidth:"xl"},n),{},{children:(0,Z.jsx)(R.Z,{children:t.map((function(n){return(0,Z.jsxs)(N.Z,{title:n.name,sx:{backgroundColor:"primary.main",borderRadius:"16px",transition:"all 200ms ease-in",marginRight:"0.5rem",display:"flex",position:"relative",maxWidth:"47vw"},children:[(0,Z.jsx)("img",{src:n.thumbnail,alt:n.name,loading:"lazy",style:{height:A.vc.thumbnails.height,width:A.vc.thumbnails.width,borderRadius:"16px"},width:A.vc.thumbnails.width,height:A.vc.thumbnails.height}),(0,Z.jsx)(N.Z,{sx:{opacity:.5,height:"40%",bottom:0,left:0,right:0,position:"absolute",display:"flex"},children:(0,Z.jsxs)(T.ZP,{container:!0,sx:{justifyContent:"space-between",alignItems:"center",margin:"0 1rem"},children:[(0,Z.jsx)(T.ZP,{item:!0,children:(0,Z.jsx)(E.Z,{sx:{},children:n.name})}),(0,Z.jsxs)(T.ZP,{item:!0,children:[(0,Z.jsx)(D.Z,{onClick:function(){return f(n)},children:(0,Z.jsx)(P.Z,{})}),(0,Z.jsx)(D.Z,{onClick:function(){return function(n){f(n),s(v.Nw.patch({showDetails:!0}))}(n)},children:(0,Z.jsx)(I.Z,{})}),(0,Z.jsx)(D.Z,{onClick:function(){return p(n)},children:(0,Z.jsx)(S.Z,{})})]})]})})]},n.drawingId)}))})})):null}!function(n){n[n.Open=0]="Open",n[n.Close=1]="Close",n[n.Stroke=2]="Stroke"}(C||(C={})),function(n){n.Pending="pending",n.Paid="paid",n.Shipped="shipped",n.Delivered="delivered",n.Cancelled="cancelled"}(b||(b={})),function(n){n.Stripe="STRIPE",n.PayPal="PAYPAL"}(k||(k={})),function(n){n.Successful="COMPLETED",n.Pending="PENDING",n.Failed="FAILED",n.Created="CREATED"}(y||(y={}));var W;y.Failed,y.Successful,y.Pending,y.Pending,y.Pending,y.Pending,y.Pending,y.Failed;function M(n){var e=n.canvasRef,t=n.contextRef,r=n.record,a=(0,o.CG)((function(n){return n.canvas.color})),i=(0,o.CG)((function(n){return n.canvas.size})),u=c.useRef(!1),s=c.useCallback((function(n,e){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==t&&void 0!==t&&t.current&&(t.current.lineTo(n,e),t.current.stroke(),a||r(C.Stroke,n,e))}),[t,r]),l=function(n,c){t.current&&e.current&&(t.current.beginPath(),t.current.lineTo(n+1,c+1),t.current.stroke(),"transparent"===a?t.current.globalCompositeOperation="destination-out":(t.current.globalCompositeOperation="source-over",t.current.strokeStyle=a||A.vc.defaultColor),t.current.lineWidth=i||A.vc.defaultLineSize,u.current=!0,e.current.style.cursor="crosshair",r(C.Open,n+1,c+1))},d=function(){t.current&&e.current&&(t.current.closePath(),u.current=!1,e.current.style.cursor="default",r(C.Close),t.current)};return c.useEffect((function(){var n=e.current,r=null===n||void 0===n?void 0:n.getContext("2d");if(n&&r){t.current=r,(0,f.oT)(n),(0,f.ZU)(r);var a=function(){(0,f.oT)(n,!0)};return window.addEventListener("resize",a),function(){return window.removeEventListener("resize",(function(){return a}))}}}),[e,t]),(0,Z.jsx)("canvas",{style:{flex:1,touchAction:"pinch-zoom"},onTouchStart:function(n){var e;if(!((null===(e=n.touches)||void 0===e?void 0:e.length)>1)){var t=n.touches[0].clientX,r=n.touches[0].clientY;l(t,r)}},onTouchMove:function(n){var e;if(!((null===(e=n.touches)||void 0===e?void 0:e.length)>1)){var t=n.touches[0].clientX,r=n.touches[0].clientY;s(t,r)}},onTouchEnd:d,onMouseDown:function(n){var e=n.nativeEvent,t=e.offsetX,r=e.offsetY;l(t,r)},onMouseUp:d,onMouseMove:function(n){var e=n.nativeEvent;if(u.current&&null!==t&&void 0!==t&&t.current){var r=e.offsetX,a=e.offsetY;s(r,a)}},ref:e})}!function(n){n.System="system",n.Provider="provider",n.Plugin="plugin"}(W||(W={}));var F=t(2221),H=t(2229),O=(0,F.ZP)(H.Z)({position:"absolute",top:"10%",left:"20%"});function U(n){var e=n.inputRef,t=n.save,r=(0,o.CG)((function(n){var e;return null===(e=n.canvas)||void 0===e?void 0:e.active})),a=(0,o.TL)(),i=c.useCallback((function(n){a(v.Nw.patchActive({name:n.target.value}))}),[a]);return(0,Z.jsx)(O,{variant:"standard",autoFocus:"draft"===r.drawingId,accessKey:"N",inputRef:e,value:(null===r||void 0===r?void 0:r.name)||"",onChange:i,onKeyUp:function(n){"Enter"===n.key&&t()}},"".concat(r.drawingId,"-").concat(r.createdAt))}var Y=t(9864),B=t(2628),X=t(1359),J=t(3391),$=t(512),K=t(9384),q=t(7953),V=t(9291),Q=t(6232),_=t(3300),nn=t.n(_);function en(){var n=(0,o.TL)(),e=(0,o.CG)((function(n){return n.canvas.showDetails})),t=(0,o.CG)((function(n){return n.canvas.active})),i=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,a,i){var c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.WY)("/drawing",{id:t,field:a,value:i},l.n$.PATCH);case 2:c=e.sent,n(v.Nw.onSave(c.data)),n((0,l.h4)(200===c.status?"Properties updated":"Error updating properties"));case 5:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}();return(0,Z.jsx)(J.Z,{open:!!e,onClose:function(){return n(v.Nw.patch({showDetails:!1}))},children:(0,Z.jsxs)($.Z,{sx:{m:"1rem 2rem 3rem 2rem"},children:[(0,Z.jsx)(E.Z,{variant:"h5",component:"h1",sx:{textAlign:"center",mb:"1rem"},children:null===t||void 0===t?void 0:t.name}),(0,Z.jsxs)(K.Z,{children:[(0,Z.jsx)(H.Z,{label:"Price",placeholder:"0.00",type:"number",variant:"filled",sx:{my:2},value:(null===t||void 0===t?void 0:t.price)||0,onChange:function(n){return i(t.drawingId,"price",Number(n.target.value))},InputProps:{startAdornment:(0,Z.jsx)(q.Z,{position:"start",children:(0,Z.jsx)(Y.Z,{})})}}),(0,Z.jsx)(V.Z,{control:(0,Z.jsx)(Q.Z,{onChange:function(n){return i(t.drawingId,"sell",n.target.checked)},checked:!(null===t||void 0===t||!t.sell),checkedIcon:(0,Z.jsx)(B.Z,{})}),label:"Monetize"}),(0,Z.jsx)(V.Z,{control:(0,Z.jsx)(Q.Z,{name:"private",onChange:function(n){return i(t.drawingId,"private",n.target.checked)},checked:!(null===t||void 0===t||!t.private),checkedIcon:(0,Z.jsx)(X.Z,{})}),label:"Don't show in gallery"}),(0,Z.jsxs)(E.Z,{sx:{color:"text.secondary",marginTop:"1rem",lineHeight:1.5,fontWeight:400,fontSize:"0.75rem",textAlign:"right"},children:["Modified:\xa0",(0,Z.jsx)(nn(),{fromNow:!0,children:t.updatedAt})]})]})]})})}var tn=t(4325),rn=t(7771),an=t(2867),cn=t(9956),on=t(4954),un=["yellow","red","blue","green","black"];function sn(n){var e=(0,o.TL)(),t=(0,o.CG)((function(n){return n.canvas.color})),r=c.useState(),a=(0,an.Z)(r,2),i=a[0],s=a[1],l=function(n){return t===n},d=function(n){var r="transparent"===n&&"transparent"===t?i:n;e(v.Nw.patch({color:r})),s(t)};return(0,Z.jsx)($.Z,(0,u.Z)((0,u.Z)({},n),{},{children:(0,Z.jsxs)(rn.Z,{spacing:1,children:[un.map((function(n){return(0,Z.jsx)(tn.Z,{sx:{backgroundColor:n},onClick:function(){return d(n)},children:l(n)&&(0,Z.jsx)(cn.Z,{})},n)})),(0,Z.jsx)(tn.Z,{title:"eraser",onClick:function(){return d("transparent")},children:(0,Z.jsx)(on.Z,{sx:{transform:l("transparent")?"rotate(-45deg)":"rotate(-90deg)",transition:"all 200ms ease-in"}})})]})}))}var ln=t(5365),dn=(0,F.ZP)(w.Z)({position:"absolute",bottom:"3%",left:"20%",width:"70%"});function fn(){var n=(0,o.CG)((function(n){return n.canvas.size})),e=(0,o.TL)();return(0,Z.jsx)(dn,{children:(0,Z.jsx)(ln.ZP,{value:n||A.vc.defaultLineSize,onChange:function(n,t){return e(v.Nw.patch({size:t}))},min:1,max:100,valueLabelDisplay:"auto",title:"Line size"})})}var vn=function(n){var e=n.newHandler,t=n.clearHandler,r=n.saveHandler,a=(0,o.TL)();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)($.Z,{sx:{position:"absolute",top:"12%",right:"3%"},children:[(0,Z.jsx)(tn.Z,{sx:{mb:2},onClick:function(){return a(v.Nw.patch({showDetails:!0}))},children:(0,Z.jsx)(I.Z,{color:"primary",fontSize:"large"})}),(0,Z.jsx)(sn,{}),(0,Z.jsxs)(rn.Z,{spacing:1,mt:"1rem",children:[(0,Z.jsx)(tn.Z,{color:"secondary",onClick:e,children:"New"}),(0,Z.jsx)(tn.Z,{color:"secondary",onClick:t,children:"Clear"}),(0,Z.jsx)(tn.Z,{color:"secondary",onClick:r,children:"Save"})]})]}),(0,Z.jsx)(fn,{})]})};function hn(){var n=(0,o.TL)(),e=(0,o.CG)((function(n){return n.app.token})),u=(0,o.CG)((function(n){var e,t;return null===(e=n.canvas)||void 0===e||null===(t=e.active)||void 0===t?void 0:t.history})),s=(0,o.CG)((function(n){var e,t;return null===(e=n.canvas)||void 0===e||null===(t=e.active)||void 0===t?void 0:t.drawingId})),d=(0,c.useRef)(null),h=(0,c.useRef)(null),g=(0,c.useRef)([]),m=(0,c.useRef)(null),C=(0,c.useRef)(null),b=(0,c.useRef)(null),k=(0,L.UO)().id,y=(0,L.s0)(),P=c.useCallback((function(n,e,t){var r,a,c=null===(r=h.current)||void 0===r?void 0:r.lineWidth,o=null===(a=h.current)||void 0===a?void 0:a.strokeStyle,u=(new Date).getTime();g.current=[].concat((0,i.Z)(g.current),[{x:e,y:t,t:n,w:c,c:o,ts:u}])}),[]),I=c.useCallback((function(){var n=d.current,e=null===n||void 0===n?void 0:n.getContext("2d");n&&e&&(e.clearRect(0,0,n.width,n.height),g.current=[],m.current=null,y("".concat(G.nB.Draw),{replace:!0}))}),[y]),S=c.useCallback((function(){I();var e=(0,f.eJ)();n(v.Nw.patch({active:e}))}),[I,n]),R=c.useCallback((0,a.Z)((0,r.Z)().mark((function t(){var a,i,c;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=d.current,i=null===a||void 0===a?void 0:a.getContext("2d"),a&&i){t.next=4;break}return t.abrupt("return");case 4:if(e){t.next=7;break}return n((0,l.r$)({dialog:"onboard"})),t.abrupt("return");case 7:return t.t0=g.current,t.next=10,(0,f.eV)(a);case 10:return t.t1=t.sent,c={history:t.t0,thumbnail:t.t1},t.next=14,n(x(c));case 14:case"end":return t.stop()}}),t)}))),[e,n]),N=c.useCallback((function(){if(d.current&&h.current){if(!b.current){var e=new Worker(new URL(t.p+t.u(691),t.b));e.onmessage=function(e){var t;h.current||console.error("no context for result"),null===(t=h.current)||void 0===t||t.putImageData(e.data,0,0),n(v.Nw.patch({loading:!1}))},b.current=e}n(v.Nw.patch({loading:!0}));var r=d.current.getBoundingClientRect(),a=r.width,i=r.height;b.current.postMessage({buffer:g.current,width:a,height:i,dpr:window.devicePixelRatio})}}),[n]);return c.useEffect((function(){if("draft"!==s){if(m.current!==s){var n="draft"===m.current&&!!s&&"draft"!==s;m.current=s,n||(g.current=u,(0,c.startTransition)((function(){N()})))}}else I()}),[s,u,N,I]),c.useEffect((function(){function e(){return(e=(0,a.Z)((0,r.Z)().mark((function e(){var t,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k||s===k){e.next=5;break}return e.next=3,n(p(k));case 3:"copy"===(null===(a=e.sent)||void 0===a||null===(t=a.payload)||void 0===t?void 0:t.drawingId)&&y("".concat(G.nB.Draw),{replace:!0});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,s,y,k]),(0,Z.jsxs)(w.Z,{maxWidth:!1,disableGutters:!0,sx:{display:"flex",flexFlow:"column"},children:[(0,Z.jsx)(M,{canvasRef:d,contextRef:h,record:P}),(0,Z.jsx)(U,{inputRef:C,save:R}),(0,Z.jsx)(vn,{newHandler:S,saveHandler:R,clearHandler:I}),(0,Z.jsx)(j,{}),(0,Z.jsx)(z,{sx:{mb:"1rem"}}),(0,Z.jsx)(en,{})]})}var pn=hn}}]);
//# sourceMappingURL=30.dd923286.chunk.js.map