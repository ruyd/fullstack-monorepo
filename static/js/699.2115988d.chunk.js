"use strict";(self.webpackChunk_root_client=self.webpackChunk_root_client||[]).push([[699],{3355:function(n,t,e){e.d(t,{cB:function(){return r.cB},h4:function(){return r.h4}});var r=e(1353);e(725)},5699:function(n,t,e){e.r(t),e.d(t,{default:function(){return nn}});var r=e(3723),a=e(7791),i=e(126),u=e(5925),o=e(8498),c=e(189),s=e(1475),l=e(3355),d=e(725),f=e(6975),v=e(4619),h=(0,s.hg)("canvas/list",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.dispatch,n.next=3,(0,d.U2)("/drawing");case 3:return 200===(i=n.sent).status&&a(v.Nw.patch({items:i.data,loaded:!0})),n.abrupt("return",i.data);case 6:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),p=(0,s.hg)("canvas/get",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,u,o,c,s,h,p,x;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.dispatch,u=e.getState,c=u(),s=null===(a=c.app.user)||void 0===a?void 0:a.userId,o=c.canvas.items.find((function(n){return n.id===t}))){n.next=12;break}return n.next=7,(0,d.U2)("/drawing/".concat(t));case 7:404===(h=n.sent).status&&i((0,l.cB)("Drawing ".concat(t," not found"))),p=h.data||(0,f.eJ)(),x=p.userId===s,o=x?p:(0,f.sn)(p);case 12:return i(v.Nw.patchActive(o)),n.abrupt("return",o);case 14:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),x=(0,s.hg)("canvas/save",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,u,o,s,f,h;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.history,i=t.thumbnail,u=e.dispatch,o=e.getState,s=o(),f=(0,c.Z)((0,c.Z)({},s.canvas.active),{},{history:a,thumbnail:i}),["draft","copy"].includes(f.id)&&(f.id=void 0),n.next=7,(0,d.WY)("/drawing",f);case 7:return 200===(h=n.sent).status&&(u(v.Nw.onSave(h.data)),u((0,l.h4)("Saved, scroll down to see"))),n.abrupt("return",h.data);case 10:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),g=(0,s.hg)("canvas/delete",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,u,o,c;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.dispatch,i=e.getState,n.next=3,(0,d.WY)("/drawing/".concat(t),null,d.n$.DELETE);case 3:if(200===n.sent.status){n.next=6;break}return n.abrupt("return");case 6:u=i().canvas.items,o=u.filter((function(n){return n.id!==t})),c=o.find((function(n){return n.id===t}))||(0,f.eJ)(),a(v.Nw.patch({items:o,active:c}));case 10:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),b=e(6749),Z=e(5697),w=e(610),m=e(2599),k=e(1182),C=e(8448);function j(){var n=(0,o.CG)((function(n){return n.canvas.loading}));return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(k.Z,{className:"".concat(n?"":"invisible"),sx:{position:"absolute",left:"50%",top:"50%"}})})}var y=e(7936),S=e(8463),R=e(277),U=e(3813),E=e(314),L=e(5997),M=e(941),T=e(3836),N=e(1892),G=e(1745);function z(){var n=(0,o.CG)((function(n){return n.canvas.items})),t=(0,o.CG)((function(n){return n.canvas.loaded})),e=(0,o.CG)((function(n){var t;return null===(t=n.canvas.active)||void 0===t?void 0:t.id})),i=(0,o.TL)(),c=(0,T.s0)(),s=(0,u.useCallback)((function(n){return i(v.Nw.patchActive(n))}),[i]),l=function(n){return e===(null===n||void 0===n?void 0:n.id)},d=(0,T.UO)().id,f=function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i(g(t.id));case 2:"fulfilled"===n.sent.meta.requestStatus&&d===t.id&&c(N.nB.Draw,{replace:!0});case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();return u.useEffect((function(){t||i(h())}),[i,t]),(0,C.jsx)(b.Z,{maxWidth:"xl",children:(0,C.jsx)(S.Z,{variant:"elevation",sx:{padding:"1rem"},children:(0,C.jsx)(R.Z,{children:n.map((function(n){return(0,C.jsxs)(U.Z,{sx:{border:"solid 1px ".concat(l(n)?"#ab47bc":"transparent"),borderWidth:"0 0 1px 0",transition:"all 200ms ease-in"},children:[(0,C.jsx)("img",{src:n.thumbnail,alt:n.name,loading:"lazy",style:{backgroundColor:"rgba(200, 163, 255, .1)",height:G.Z.thumbnails.height,width:G.Z.thumbnails.width},width:G.Z.thumbnails.width,height:G.Z.thumbnails.height}),(0,C.jsx)(E.Z,{title:n.name,actionIcon:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(L.Z,{onClick:function(){return s(n)},children:"Edit"}),(0,C.jsx)(M.Z,{onClick:function(){return f(n)},children:(0,C.jsx)(y.Z,{})})]})})]},n.id)}))})})})}var D=e(9505);function O(n){var t=n.canvasRef,e=n.contextRef,r=n.record,a=(0,o.CG)((function(n){return n.canvas.color})),i=(0,o.CG)((function(n){return n.canvas.size})),c=u.useRef(!1),s=u.useCallback((function(n,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==e&&void 0!==e&&e.current&&(e.current.lineTo(n,t),e.current.stroke(),a||r(D.Us.Stroke,n,t))}),[e,r]),l=function(n,u){e.current&&t.current&&(e.current.beginPath(),e.current.lineTo(n+1,u+1),e.current.stroke(),"transparent"===a?e.current.globalCompositeOperation="destination-out":(e.current.globalCompositeOperation="source-over",e.current.strokeStyle=a||"black"),e.current.lineWidth=i||G.Z.defaultLineSize,c.current=!0,t.current.style.cursor="crosshair",r(D.Us.Open,n+1,u+1))},d=function(){e.current&&t.current&&(e.current.closePath(),c.current=!1,t.current.style.cursor="default",r(D.Us.Close),e.current)};return u.useEffect((function(){var n=t.current,r=null===n||void 0===n?void 0:n.getContext("2d");if(n&&r){(0,f.ZU)(r),e.current=r,(0,f.oT)(n);var a=function(){(0,f.oT)(n,!0)};return window.addEventListener("resize",a),function(){return window.removeEventListener("resize",(function(){return a}))}}}),[t,e]),(0,C.jsx)("canvas",{style:{flex:1},onTouchStart:function(n){var t;if(!((null===(t=n.touches)||void 0===t?void 0:t.length)>1)){var e=n.touches[0].clientX,r=n.touches[0].clientY;l(e,r)}},onTouchMove:function(n){var t;if(!((null===(t=n.touches)||void 0===t?void 0:t.length)>1)){var e=n.touches[0].clientX,r=n.touches[0].clientY;s(e,r)}},onTouchEnd:d,onMouseDown:function(n){var t=n.nativeEvent,e=t.offsetX,r=t.offsetY;l(e,r)},onMouseUp:d,onMouseMove:function(n){var t=n.nativeEvent;if(c.current&&null!==e&&void 0!==e&&e.current){var r=t.offsetX,a=t.offsetY;s(r,a)}},ref:t})}var P=e(5809),W=e(6345),B=e(397),Y=["yellow","red","blue","green","black"];function A(n){var t=(0,o.TL)(),e=(0,o.CG)((function(n){return n.canvas.color})),r=u.useState(),a=(0,P.Z)(r,2),i=a[0],s=a[1],l=function(n){return e===n},d=function(n){var r="transparent"===n&&"transparent"===e?i:n;t(v.Nw.patch({color:r})),s(e)};return(0,C.jsx)(Z.Z,(0,c.Z)((0,c.Z)({},n),{},{children:(0,C.jsxs)(w.Z,{spacing:1,children:[Y.map((function(n){return(0,C.jsx)(m.Z,{sx:{backgroundColor:n},onClick:function(){return d(n)},children:l(n)&&(0,C.jsx)(W.Z,{})},n)})),(0,C.jsx)(m.Z,{title:"eraser",onClick:function(){return d("transparent")},children:(0,C.jsx)(B.Z,{sx:{transform:l("transparent")?"rotate(-45deg)":"rotate(-90deg)",transition:"all 200ms ease-in"}})})]})}))}var F=e(815),I=e(8653),X=(0,F.ZP)(I.ZP)((function(){return{color:"#7e57c2",height:8,"& .MuiSlider-track":{border:"none"},"& .MuiSlider-thumb":{transition:"all 1s ease-in-out",height:24,width:24,backgroundColor:"#000",border:"2px solid currentColor","&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:"inherit"},"&:before":{display:"none"}},"& .MuiSlider-valueLabel":{lineHeight:1.2,fontSize:12,background:"unset",padding:0,width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"#7e57c2",transformOrigin:"bottom left",transform:"translate(50%, -100%) rotate(-45deg) scale(0)","&:before":{display:"none"},"&.MuiSlider-valueLabelOpen":{transform:"translate(50%, -100%) rotate(-45deg) scale(1)"},"& > *":{transform:"rotate(45deg)"}}}}));function _(n){return(0,C.jsx)(X,(0,c.Z)({},n))}function J(n){var t,e,r=n.buffer,a=(0,o.CG)((function(n){var t;return null===(t=n.canvas)||void 0===t?void 0:t.active})),i=(null===r||void 0===r||null===(t=r.current)||void 0===t?void 0:t.length)||1,c=u.useState([]),s=(0,P.Z)(c,2),l=s[0],d=s[1];return console.log(a),(0,u.useEffect)((function(){var n=[{value:0,label:"0"}];i>0&&n.push({value:i,label:"".concat(i)}),d(n)}),[i]),(0,C.jsx)(Z.Z,{sx:{width:"300px",margin:"0 auto"},children:(0,C.jsx)(_,{max:null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.length,marks:l})})}var K=e(5163),V=(0,F.ZP)(K.Z)({position:"absolute",top:"10%",left:"20%"});function q(n){var t=n.inputRef,e=n.save,r=(0,o.CG)((function(n){var t;return null===(t=n.canvas)||void 0===t?void 0:t.active})),a=(0,o.TL)(),i=u.useCallback((function(n){a(v.Nw.patchActive({name:n.target.value}))}),[a]);return(0,C.jsx)(V,{variant:"standard",autoFocus:"draft"===r.id,accessKey:"N",inputRef:t,value:(null===r||void 0===r?void 0:r.name)||"",onChange:i,onKeyUp:function(n){"Enter"===n.key&&e()}},"".concat(r.id,"-").concat(r.createdAt))}var H=(0,F.ZP)(b.Z)({position:"absolute",bottom:"3%",left:"20%",width:"70%"});function $(){var n=(0,o.CG)((function(n){return n.canvas.size})),t=(0,o.TL)();return(0,C.jsx)(H,{children:(0,C.jsx)(I.ZP,{value:n||G.Z.defaultLineSize,onChange:function(n,e){return t(v.Nw.patch({size:e}))},min:1,max:100,valueLabelDisplay:"auto",title:"Line size"})})}function Q(){var n=(0,o.TL)(),t=(0,o.CG)((function(n){var t,e;return null===(t=n.canvas)||void 0===t||null===(e=t.active)||void 0===e?void 0:e.history})),c=(0,o.CG)((function(n){var t,e;return null===(t=n.canvas)||void 0===t||null===(e=t.active)||void 0===e?void 0:e.id})),s=(0,u.useRef)(null),l=(0,u.useRef)(null),d=(0,u.useRef)([]),h=(0,u.useRef)(null),g=(0,u.useRef)(null),k=(0,u.useRef)(null),y=(0,T.UO)().id,S=(0,T.s0)(),R=u.useCallback((function(n,t,e){var r,a,u=null===(r=l.current)||void 0===r?void 0:r.lineWidth,o=null===(a=l.current)||void 0===a?void 0:a.strokeStyle,c=(new Date).getTime();d.current=[].concat((0,i.Z)(d.current),[{x:t,y:e,t:n,w:u,c:o,ts:c}])}),[]),U=u.useCallback((function(){var n=s.current,t=null===n||void 0===n?void 0:n.getContext("2d");n&&t&&(t.clearRect(0,0,n.width,n.height),d.current=[],h.current=null,S("".concat(N.nB.Draw),{replace:!0}))}),[S]),E=u.useCallback((function(){U();var t=(0,f.eJ)();n(v.Nw.patch({active:t}))}),[U,n]),L=u.useCallback((0,a.Z)((0,r.Z)().mark((function t(){var e,a,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.current,a=null===e||void 0===e?void 0:e.getContext("2d"),e&&a){t.next=4;break}return t.abrupt("return");case 4:return t.t0=d.current,t.next=7,(0,f.eV)(e);case 7:return t.t1=t.sent,i={history:t.t0,thumbnail:t.t1},t.next=11,n(x(i));case 11:case"end":return t.stop()}}),t)}))),[n]),M=u.useCallback((function(){if(s.current&&l.current){if(!k.current){var t=new Worker(new URL(e.p+e.u(800),e.b));t.onmessage=function(t){var e;l.current||console.error("no context for result"),null===(e=l.current)||void 0===e||e.putImageData(t.data,0,0),n(v.Nw.patch({loading:!1}))},k.current=t}n(v.Nw.patch({loading:!0}));var r=s.current.getBoundingClientRect(),a=r.width,i=r.height;k.current.postMessage({buffer:d.current,width:a,height:i,dpr:window.devicePixelRatio})}}),[n]);return u.useEffect((function(){if("draft"!==c){if(h.current!==c){var n="draft"===h.current&&!!c&&"draft"!==c;h.current=c,n||(d.current=t,(0,u.startTransition)((function(){M()})))}}else U()}),[c,t,M,U]),u.useEffect((function(){function t(){return(t=(0,a.Z)((0,r.Z)().mark((function t(){var e,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!y||c===y){t.next=5;break}return t.next=3,n(p(y));case 3:"copy"===(null===(a=t.sent)||void 0===a||null===(e=a.payload)||void 0===e?void 0:e.id)&&S("".concat(N.nB.Draw),{replace:!0});case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[n,c,S,y]),(0,C.jsxs)(b.Z,{maxWidth:!1,disableGutters:!0,sx:{display:"flex",flexFlow:"column"},children:[(0,C.jsx)(O,{canvasRef:s,contextRef:l,record:R}),(0,C.jsx)(q,{inputRef:g,save:L}),(0,C.jsxs)(Z.Z,{sx:{position:"absolute",top:"30%",right:"3%"},children:[(0,C.jsx)(A,{}),(0,C.jsxs)(w.Z,{spacing:1,mt:"1rem",children:[(0,C.jsx)(m.Z,{color:"secondary",onClick:E,children:"New"}),(0,C.jsx)(m.Z,{color:"secondary",onClick:U,children:"Clear"}),(0,C.jsx)(m.Z,{color:"secondary",onClick:L,children:"Save"})]})]}),(0,C.jsx)($,{}),(0,C.jsx)(j,{}),(0,C.jsx)(J,{buffer:d}),(0,C.jsx)(z,{})]})}function nn(){return(0,C.jsx)("div",{children:(0,C.jsx)(Q,{})})}},9505:function(n,t,e){e.d(t,{Us:function(){return r.Us},g9:function(){return r.g9}});var r=e(5372)},595:function(n,t,e){var r;function a(n){var t=Math.round(function(n){if(n.history.length<2)return 0;var t=n.history[0].ts;return n.history[n.history.length-1].ts-t}(n)/1e3),e=Math.round(t/60),r=Math.round(e/60),a=t%60;return"".concat(r,"h:").concat(e,"m:").concat(a,"s")}e.d(t,{Us:function(){return r},g9:function(){return a}}),function(n){n[n.Open=0]="Open",n[n.Close=1]="Close",n[n.Stroke=2]="Stroke"}(r||(r={}))},5372:function(n,t,e){e.d(t,{Us:function(){return r.Us},g9:function(){return r.g9}});var r=e(595)}}]);
//# sourceMappingURL=699.2115988d.chunk.js.map