"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[540],{9540:function(n,t,e){e.r(t),e.d(t,{default:function(){return H}});var r=e(2723),a=e(4795),i=e(8777),c=e(969),u=e(7563),o=e(3028),s=e(8068),l=e(3649),d=e(1576),f=e(9008),v=e(804),h=(0,s.hg)("canvas/list",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.dispatch,n.next=3,(0,d.U2)("/drawing");case 3:return 200===(i=n.sent).status&&a(v.Nw.patch({items:i.data.items,loaded:!0})),n.abrupt("return",i.data);case 6:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),p=(0,s.hg)("canvas/get",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,c,u,o,s,h,p,x;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.dispatch,c=e.getState,o=c(),s=null===(a=o.app.user)||void 0===a?void 0:a.userId,u=o.canvas.items.find((function(n){return n.id===t}))){n.next=12;break}return n.next=7,(0,d.U2)("/drawing/".concat(t));case 7:404===(h=n.sent).status&&i((0,l.cB)("Drawing ".concat(t," not found"))),p=h.data||(0,f.eJ)(),x=p.userId===s,u=x?p:(0,f.sn)(p);case 12:return i(v.Nw.patchActive(u)),n.abrupt("return",u);case 14:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),x=(0,s.hg)("canvas/save",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,c,u,s,f,h;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.history,i=t.thumbnail,c=e.dispatch,u=e.getState,s=u(),f=(0,o.Z)((0,o.Z)({},s.canvas.active),{},{history:a,thumbnail:i}),["draft","copy"].includes(f.id)&&(f.id=void 0),n.next=7,(0,d.WY)("/drawing",f);case 7:return 200===(h=n.sent).status&&(c(v.Nw.onSave(h.data)),c((0,l.h4)("Saved, scroll down to see"))),n.abrupt("return",h.data);case 10:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),g=(0,s.hg)("canvas/delete",function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t,e){var a,i,c,u,o;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.dispatch,i=e.getState,n.next=3,(0,d.WY)("/drawing/".concat(t),null,d.n$.DELETE);case 3:if(200===n.sent.status){n.next=6;break}return n.abrupt("return");case 6:c=i().canvas.items,u=c.filter((function(n){return n.id!==t})),o=u.find((function(n){return n.id===t}))||(0,f.eJ)(),a(v.Nw.patch({items:u,active:o}));case 10:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}()),Z=e(2563),w=e(5260),m=e(7771),b=e(4325),C=e(325),k=e(7574);function j(){var n=(0,u.CG)((function(n){return n.canvas.loading}));return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(C.Z,{className:"".concat(n?"":"invisible"),sx:{position:"absolute",left:"50%",top:"50%"}})})}var y=e(2207),R=e(4780),S=e(5433),U=e(7406),T=e(1874),E=e(4417),N=e(6385),L=e(734),G=e(7024),z=e(1925);function D(n){var t=(0,u.CG)((function(n){return n.canvas.items})),e=(0,u.CG)((function(n){return n.canvas.loaded})),i=(0,u.CG)((function(n){var t;return null===(t=n.canvas.active)||void 0===t?void 0:t.id})),s=(0,u.TL)(),l=(0,L.s0)(),d=(0,c.useCallback)((function(n){return s(v.Nw.patchActive(n))}),[s]),f=function(n){return i===(null===n||void 0===n?void 0:n.id)},p=(0,L.UO)().id,x=function(){var n=(0,a.Z)((0,r.Z)().mark((function n(t){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s(g(t.id));case 2:"fulfilled"===n.sent.meta.requestStatus&&p===t.id&&l(G.nB.Draw,{replace:!0});case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();return c.useEffect((function(){e||s(h())}),[s,e]),t.length?(0,k.jsx)(Z.Z,(0,o.Z)((0,o.Z)({maxWidth:"xl"},n),{},{children:(0,k.jsx)(R.Z,{variant:"elevation",sx:{padding:"1rem"},children:(0,k.jsx)(S.Z,{children:t.map((function(n){return(0,k.jsxs)(U.Z,{sx:{border:"solid 1px ".concat(f(n)?"#ab47bc":"transparent"),borderWidth:"0 0 1px 0",transition:"all 200ms ease-in"},children:[(0,k.jsx)("img",{src:n.thumbnail,alt:n.name,loading:"lazy",style:{backgroundColor:"rgba(200, 163, 255, .1)",height:z.Z.thumbnails.height,width:z.Z.thumbnails.width},width:z.Z.thumbnails.width,height:z.Z.thumbnails.height}),(0,k.jsx)(T.Z,{title:n.name,actionIcon:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(E.Z,{onClick:function(){return d(n)},children:"Edit"}),(0,k.jsx)(N.Z,{onClick:function(){return x(n)},children:(0,k.jsx)(y.Z,{})})]})})]},n.id)}))})})})):null}var M=e(8658);function W(n){var t=n.canvasRef,e=n.contextRef,r=n.record,a=(0,u.CG)((function(n){return n.canvas.color})),i=(0,u.CG)((function(n){return n.canvas.size})),o=c.useRef(!1),s=c.useCallback((function(n,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!==e&&void 0!==e&&e.current&&(e.current.lineTo(n,t),e.current.stroke(),a||r(M.Us.Stroke,n,t))}),[e,r]),l=function(n,c){e.current&&t.current&&(e.current.beginPath(),e.current.lineTo(n+1,c+1),e.current.stroke(),"transparent"===a?e.current.globalCompositeOperation="destination-out":(e.current.globalCompositeOperation="source-over",e.current.strokeStyle=a||z.Z.defaultColor),e.current.lineWidth=i||z.Z.defaultLineSize,o.current=!0,t.current.style.cursor="crosshair",r(M.Us.Open,n+1,c+1))},d=function(){e.current&&t.current&&(e.current.closePath(),o.current=!1,t.current.style.cursor="default",r(M.Us.Close),e.current)};return c.useEffect((function(){var n=t.current,r=null===n||void 0===n?void 0:n.getContext("2d");if(n&&r){e.current=r,(0,f.oT)(n),(0,f.ZU)(r);var a=function(){(0,f.oT)(n,!0)};return window.addEventListener("resize",a),function(){return window.removeEventListener("resize",(function(){return a}))}}}),[t,e]),(0,k.jsx)("canvas",{style:{flex:1,touchAction:"pinch-zoom"},onTouchStart:function(n){var t;if(!((null===(t=n.touches)||void 0===t?void 0:t.length)>1)){var e=n.touches[0].clientX,r=n.touches[0].clientY;l(e,r)}},onTouchMove:function(n){var t;if(!((null===(t=n.touches)||void 0===t?void 0:t.length)>1)){var e=n.touches[0].clientX,r=n.touches[0].clientY;s(e,r)}},onTouchEnd:d,onMouseDown:function(n){var t=n.nativeEvent,e=t.offsetX,r=t.offsetY;l(e,r)},onMouseUp:d,onMouseMove:function(n){var t=n.nativeEvent;if(o.current&&null!==e&&void 0!==e&&e.current){var r=t.offsetX,a=t.offsetY;s(r,a)}},ref:t})}var O=e(2867),P=e(9956),Y=e(4954),A=["yellow","red","blue","green","black"];function B(n){var t=(0,u.TL)(),e=(0,u.CG)((function(n){return n.canvas.color})),r=c.useState(),a=(0,O.Z)(r,2),i=a[0],s=a[1],l=function(n){return e===n},d=function(n){var r="transparent"===n&&"transparent"===e?i:n;t(v.Nw.patch({color:r})),s(e)};return(0,k.jsx)(w.Z,(0,o.Z)((0,o.Z)({},n),{},{children:(0,k.jsxs)(m.Z,{spacing:1,children:[A.map((function(n){return(0,k.jsx)(b.Z,{sx:{backgroundColor:n},onClick:function(){return d(n)},children:l(n)&&(0,k.jsx)(P.Z,{})},n)})),(0,k.jsx)(b.Z,{title:"eraser",onClick:function(){return d("transparent")},children:(0,k.jsx)(Y.Z,{sx:{transform:l("transparent")?"rotate(-45deg)":"rotate(-90deg)",transition:"all 200ms ease-in"}})})]})}))}var F=e(2221),I=e(7102),X=(0,F.ZP)(I.Z)({position:"absolute",top:"10%",left:"20%"});function J(n){var t=n.inputRef,e=n.save,r=(0,u.CG)((function(n){var t;return null===(t=n.canvas)||void 0===t?void 0:t.active})),a=(0,u.TL)(),i=c.useCallback((function(n){a(v.Nw.patchActive({name:n.target.value}))}),[a]);return(0,k.jsx)(X,{variant:"standard",autoFocus:"draft"===r.id,accessKey:"N",inputRef:t,value:(null===r||void 0===r?void 0:r.name)||"",onChange:i,onKeyUp:function(n){"Enter"===n.key&&e()}},"".concat(r.id,"-").concat(r.createdAt))}var K=e(3069),q=(0,F.ZP)(Z.Z)({position:"absolute",bottom:"3%",left:"20%",width:"70%"});function V(){var n=(0,u.CG)((function(n){return n.canvas.size})),t=(0,u.TL)();return(0,k.jsx)(q,{children:(0,k.jsx)(K.ZP,{value:n||z.Z.defaultLineSize,onChange:function(n,e){return t(v.Nw.patch({size:e}))},min:1,max:100,valueLabelDisplay:"auto",title:"Line size"})})}function $(){var n=(0,u.TL)(),t=(0,u.CG)((function(n){var t,e;return null===(t=n.canvas)||void 0===t||null===(e=t.active)||void 0===e?void 0:e.history})),o=(0,u.CG)((function(n){var t,e;return null===(t=n.canvas)||void 0===t||null===(e=t.active)||void 0===e?void 0:e.id})),s=(0,c.useRef)(null),l=(0,c.useRef)(null),d=(0,c.useRef)([]),h=(0,c.useRef)(null),g=(0,c.useRef)(null),C=(0,c.useRef)(null),y=(0,L.UO)().id,R=(0,L.s0)(),S=c.useCallback((function(n,t,e){var r,a,c=null===(r=l.current)||void 0===r?void 0:r.lineWidth,u=null===(a=l.current)||void 0===a?void 0:a.strokeStyle,o=(new Date).getTime();d.current=[].concat((0,i.Z)(d.current),[{x:t,y:e,t:n,w:c,c:u,ts:o}])}),[]),U=c.useCallback((function(){var n=s.current,t=null===n||void 0===n?void 0:n.getContext("2d");n&&t&&(t.clearRect(0,0,n.width,n.height),d.current=[],h.current=null,R("".concat(G.nB.Draw),{replace:!0}))}),[R]),T=c.useCallback((function(){U();var t=(0,f.eJ)();n(v.Nw.patch({active:t}))}),[U,n]),E=c.useCallback((0,a.Z)((0,r.Z)().mark((function t(){var e,a,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.current,a=null===e||void 0===e?void 0:e.getContext("2d"),e&&a){t.next=4;break}return t.abrupt("return");case 4:return t.t0=d.current,t.next=7,(0,f.eV)(e);case 7:return t.t1=t.sent,i={history:t.t0,thumbnail:t.t1},t.next=11,n(x(i));case 11:case"end":return t.stop()}}),t)}))),[n]),N=c.useCallback((function(){if(s.current&&l.current){if(!C.current){var t=new Worker(new URL(e.p+e.u(997),e.b));t.onmessage=function(t){var e;l.current||console.error("no context for result"),null===(e=l.current)||void 0===e||e.putImageData(t.data,0,0),n(v.Nw.patch({loading:!1}))},C.current=t}n(v.Nw.patch({loading:!0}));var r=s.current.getBoundingClientRect(),a=r.width,i=r.height;C.current.postMessage({buffer:d.current,width:a,height:i,dpr:window.devicePixelRatio})}}),[n]);return c.useEffect((function(){if("draft"!==o){if(h.current!==o){var n="draft"===h.current&&!!o&&"draft"!==o;h.current=o,n||(d.current=t,(0,c.startTransition)((function(){N()})))}}else U()}),[o,t,N,U]),c.useEffect((function(){function t(){return(t=(0,a.Z)((0,r.Z)().mark((function t(){var e,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!y||o===y){t.next=5;break}return t.next=3,n(p(y));case 3:"copy"===(null===(a=t.sent)||void 0===a||null===(e=a.payload)||void 0===e?void 0:e.id)&&R("".concat(G.nB.Draw),{replace:!0});case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[n,o,R,y]),(0,k.jsxs)(Z.Z,{maxWidth:!1,disableGutters:!0,sx:{display:"flex",flexFlow:"column"},children:[(0,k.jsx)(W,{canvasRef:s,contextRef:l,record:S}),(0,k.jsx)(J,{inputRef:g,save:E}),(0,k.jsxs)(w.Z,{sx:{position:"absolute",top:"30%",right:"3%"},children:[(0,k.jsx)(B,{}),(0,k.jsxs)(m.Z,{spacing:1,mt:"1rem",children:[(0,k.jsx)(b.Z,{color:"secondary",onClick:T,children:"New"}),(0,k.jsx)(b.Z,{color:"secondary",onClick:U,children:"Clear"}),(0,k.jsx)(b.Z,{color:"secondary",onClick:E,children:"Save"})]})]}),(0,k.jsx)(V,{}),(0,k.jsx)(j,{}),(0,k.jsx)(D,{sx:{mb:"1rem"}})]})}function H(){return(0,k.jsx)("div",{children:(0,k.jsx)($,{})})}},8658:function(n,t,e){e.d(t,{Us:function(){return r.Us},g9:function(){return r.g9}});var r=e(7413)},7926:function(n,t,e){var r;function a(n){var t=Math.round(function(n){if(n.history.length<2)return 0;var t=n.history[0].ts;return n.history[n.history.length-1].ts-t}(n)/1e3),e=Math.round(t/60),r=Math.round(e/60),a=t%60;return"".concat(r,"h:").concat(e,"m:").concat(a,"s")}e.d(t,{Us:function(){return r},g9:function(){return a}}),function(n){n[n.Open=0]="Open",n[n.Close=1]="Close",n[n.Stroke=2]="Stroke"}(r||(r={}))},7413:function(n,t,e){e.d(t,{Us:function(){return r.Us},g9:function(){return r.g9}});var r=e(7926)}}]);
//# sourceMappingURL=540.4badd47f.chunk.js.map